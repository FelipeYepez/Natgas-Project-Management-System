<%- include('includes/openHTML.ejs'); %>
<%- include('includes/navbar.ejs'); %>
<main>
    <div>
        <div class="row center-align">
            <div class="col s6 offset-s3">
                <h2>Tareas por Caso de Uso</h2>
            </div>
        </div>
        <hr>
        <br>
        <div class="row container">
            <% if(lista_quiero.length !== 0) { %>
                <!-- Quiero -->
                <div class="col s6 m6 l6" id="tabla_caso_uso_tareas">
                    <table class="highlight">
                        <form action="tarea-caso-uso" method="POST">
                            <thead> 
                                <tr>
                                    <th class="center-align">Quiero</th>
                                    <th class="right-align">
                                        <button class="btn waves-effect waves-light" type="submit" name="action">
                                            <i class="material-icons">forward</i>
                                        </button>
                                    </th>      
                                </tr>
                            </thead>
                    
                            <tbody>
                                <% for (quiero of lista_quiero) { %>
                                    <tr>
                                        <td>
                                            <label>
                                                <input name="boton_radio" type="radio" value="<%= quiero.id_casos %>"/>
                                                <span>
                                                    <div><strong><%= quiero.quiero %></strong></div>
                                                </span>
                                            </label> 
                                        </td>
                                        <!-- Alargar la linea... -->
                                        <td></td>
                                    </tr>
                                <% } %>
                            </tbody>
                            <!-- Cerrar y mandar parametros de forma para hacer submit -->
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>"> 
                            <input type="hidden" name="idCaso" value="<%= quiero.id_casos %>">
                        </form>
                    </table>
                </div>
                
                <!-- Tareas del Proyecto -->
                <div class="col s6 m6 l6">
                    <div id="fasesVert" class="container">
                        <% for (let fase_tarea = 0; fase_tarea < lista_tareas.length; fase_tarea++) { 
                            <!-- Si va empezando o cambia de fase  -->
                            if(fase_tarea === 0 || lista_tareas[fase_tarea].nombre_fase !== lista_tareas[fase_tarea - 1].nombre_fase){ %>
                                <!-- Empieza bloque de la fase -->
                                <div id="faseVert" class="center-align">
                                    <!-- Título de la fase -->
                                    <div id="titulo-fase">
                                        <span class=""> <%= lista_tareas[fase_tarea].nombre_fase %>: </span>
                                    </div>
                                <!-- Empieza div para desplegar tareas de la fase -->
                                <div>
                            <% } %>
                            <!-- Despliegue de tareas de la fase -->
                            <div id="tarea-en-fase">
                                <label>
                                    <input type="checkbox" class="filled-in" checked="checked" />
                                    <span> <%= lista_tareas[fase_tarea].nombre_practica_trabajo %> </span>
                                </label>
                            </div>
                            <!-- Si es la última tarea de todas o de una fase, cierra la división para la fase -->
                            <% if(fase_tarea === lista_tareas.length - 1 || lista_tareas[fase_tarea].nombre_fase !== lista_tareas[fase_tarea + 1].nombre_fase) { %> 
                                <!-- Cierra bloque de tareas  -->
                                </div>
                                <!-- Cierra bloque de fase -->
                                </div>
                            <% } %>
                        <% } %>
                    </div>
                </div>
            <% } else { %>
                <h4>No se encontraron casos de uso para esta iteracion</h4>
            <% } %>
        </div>
    </div>
</main>


<%- include('includes/closeHTML.ejs'); %>