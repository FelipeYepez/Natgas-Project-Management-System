<%- include('includes/openHTML.ejs'); %>

<%- include('includes/navbarPrincipal.ejs'); %>

<% if (alerta) { %>
    <script>alert("<%= alerta %>");</script>
<% } %> 


    <div class="row">
      <div class="col s6 offset-s6">
        <a href="#!" class=" blue  black-text breadcrumb">First</a>
        <a href="#!" class="blue  black-text breadcrumb">Second</a>
        <a href="#!" class="blue black-text breadcrumb">Third</a>
      </div>
    </div>


<div class="row">
    <div class="col s2 offset-s9">
      <div class="row">
        <div class="input-field col s12">
          <i class="material-icons prefix">search</i>
          <input type="text" id="autocomplete-input" class="autocomplete" placeholder="Search">
        </div>
      </div>
    </div>
  </div>

<!-- Set de tres tarjetas -->
<div class="row center">
    <div class="col offset-m3 offset-l3">
        <% for (let proyecto of proyectos) { %>
        <div class="col s3">
            <div class="card small">
                <div class="card-image">
                    <img src="<%= proyecto.imagen %>" alt="Proyecto">
                    <div id="modal1_<%= proyecto.id_proyecto %>" class="modal large">
                        <form action="/home/modificar-proyecto" method="POST">
                        <!-- Modal Content -->
                            <div class="modal-content">
                                <input type="hidden" name="_csrf" value="<%= csrfToken %>" >
                                <input type="hidden" name="id_proyecto" value="<%= proyecto.id_proyecto %>">
                                    <div class="col s6 offset-s3">
                                        <div class="row">
                                            <div class="input-field col s11">
                                                <input  id="nombre_proyecto" type="text" class="validate" name="nombre" value="<%= proyecto.nombre_proyecto %>" required>
                                                <label for="nombre_proyecto">Nombre del proyecto</label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="input-field col s11">
                                                <input  id="descripcion_proyecto" type="text" class="validate" name="descripcion" value="<%= proyecto.descripcion %>">
                                                <label for="descripcion_proyecto">Descripción del proyecto</label>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="input-field col s11">
                                                <select name="departamento" class="browser-default" required>
                                                    <% for (let departamento of departamentos) { %>
                                                        <% if ( departamento.id_departamento == proyecto.id_departamento) { %>
                                                            <option value="<%= proyecto.id_departamento %>" selected><%= proyecto.nombre_departamento %> </option>
                                                        <% } else{ %>
                                                            <option value="<%= departamento.id_departamento %>"><%= departamento.nombre_departamento %></option>
                                                        <% } %>
                                                    <% } %>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col s11 ">
                                                <a class="modal-close waves-effect waves-green btn-flat ">Cancelar</a>
                                                <button type="submit" class="waves-effect waves-green btn-flat" name="action" value="editar">Aceptar</button>
                                            </div>
                                        </div>
                                    </div>
                            </div>  
                        </form>
                    </div>
                </div>
                <div class="card-content">
                    <span><%= proyecto.nombre_proyecto %></span>
                    <a class='dropdown-trigger grey-text text-darken-4' data-target='dropdown1_<%= proyecto.nombre_proyecto %>'><i class="material-icons right">more_vert</i></a>
                    <ul id='dropdown1_<%= proyecto.nombre_proyecto %>' class='dropdown-content'>
                        <li><a data-target="modal1_<%= proyecto.id_proyecto %>" class="modal-trigger"><i class="material-icons right">mode_edit</i></a></li>
                        <li>
                            <form action="/home/eliminar-proyecto" method="POST" id="eliminar_<%= proyecto.id_proyecto %>">
                                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                <input type="hidden" name="id_proyecto" value="<%= proyecto.id_proyecto %>">
                                <button type="submit" class="waves-effect waves-green btn-flat"><i class="material-icons">delete</i>Eliminar</button>
                                <script> 
                                    document.getElementById("eliminar_<%= proyecto.id_proyecto %>").addEventListener('submit', (e) => {
                                      let confirmacion = confirm('¿Estás seguro de eliminar el proyecto?');
                                      if(!confirmacion){
                                        e.preventDefault();
                                      }  
                                    });
                                </script>
                            </form>
                        </li>
                    </ul>
                </div>
                <div class="card-action">
                    <form action="home" method="POST">
                        <input type="hidden" name="_csrf" value="<%= csrfToken %>" >
                        <input type="hidden" name="idProyecto" value="<%= proyecto.id_proyecto %>" >
                        <button class="btn-flat" type="submit">Ir al proyecto</botton>
                    </form>
                </div>
            </div>
        </div>
        <% } %>
    </div>    
</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
    let autocomplete = document.getElementById("autocomplete-input");
    
    let options = {};

    "<%for (let i = 0; i < proyectos.length; i++) { %>"
         options["<%=proyectos[i].nombre_proyecto%>"] = null;
     "<% } %>"
      
    var instances = M.Autocomplete.init(autocomplete, { data : options });
      
    });

</script>

<%- include('includes/closeHTML.ejs'); %>